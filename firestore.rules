/**
 * @file Firestore Security Rules
 * @description This ruleset enforces a strict data model where Clients and Jobs are top-level collections,
 * and Expenses and Income are subcollections nested under Jobs.  Since there is no auth, the rules are open to the public
 * in order to iterate quickly on the data shapes.
 *
 * Data Structure:
 * - /clients/{clientId}: Stores client information.
 * - /jobs/{jobId}: Stores job information, including a clientId.
 * - /jobs/{jobId}/expenses/{expenseId}: Stores expenses related to a specific job.
 * - /jobs/{jobId}/income/{incomeId}: Stores income payments related to a specific job.
 *
 * Key Security Decisions:
 * - Public read and write access for rapid prototyping given no authentication.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Allows anyone to read or write client data.
     * @path /clients/{clientId}
     * @allow (get, list, create, update, delete)
     * @principle Open access for prototyping
     */
    match /clients/{clientId} {
      allow get, list: if true;
      allow create, update, delete: if true;
    }

    /**
     * @description Allows anyone to read or write job data.
     * @path /jobs/{jobId}
     * @allow (get, list, create, update, delete)
     * @principle Open access for prototyping
     */
    match /jobs/{jobId} {
      allow get, list: if true;
      allow create, update, delete: if true;

      /**
       * @description Allows anyone to read or write expense data for a specific job.
       * @path /jobs/{jobId}/expenses/{expenseId}
       * @allow (get, list, create, update, delete)
       * @principle Open access for prototyping
       */
      match /expenses/{expenseId} {
        allow get, list: if true;
        allow create, update, delete: if true;
      }

      /**
       * @description Allows anyone to read or write income data for a specific job.
       * @path /jobs/{jobId}/income/{incomeId}
       * @allow (get, list, create, update, delete)
       * @principle Open access for prototyping
       */
      match /income/{incomeId} {
        allow get, list: if true;
        allow create, update, delete: if true;
      }
    }
  }
}